\section{gfal\_\-testrw.c}
This exemple show how to open, write a file and read it after ex : use case with SRM plugin : ./gfal\_\-testrw srm://grid05.lal.in2p3.fr:8446/dpm/lal.in2p3.fr/home/dteam/test\_\-yoda



\begin{DocInclude}\begin{verbatim}1 
7 #include <fcntl.h>
8 #include <stdio.h>
9 #include <gfal_api.h>
10 #include <stdlib.h>
11 #define BLKLEN 65536
12 
13 main(int argc, char **argv)
14 {
15    int fd;
16    int i;
17    char ibuf[BLKLEN];
18    char obuf[BLKLEN];
19    int rc;
20 
21    // gfal_set_verbose(GFAL_VERBOSE_TRACE | GFAL_VERBOSE_VERBOSE);      // switch Gfal in verbose mode
22    if (argc != 2) {
23            fprintf (stderr, "usage: %s filename\n", argv[0]);
24            exit (1);
25    }
26 
27    for (i = 0; i < BLKLEN; i++)
28            obuf[i] = i;
29 
30    printf ("creating file %s\n", argv[1]);
31    if ((fd = gfal_open (argv[1], O_WRONLY|O_CREAT, 0644)) < 0) {
32                 gfal_posix_check_error();
33                 exit (1);
34    }
35    
36         printf ("open successful, fd = %d\n", fd);
37 
38         if ((rc = gfal_write (fd, obuf, BLKLEN)) != BLKLEN) {
39                 gfal_posix_check_error();
40                 (void) gfal_close (fd);
41                 exit (1);
42         }
43         printf ("write successful\n");
44 
45         if ((rc = gfal_close (fd)) < 0) {
46                 gfal_posix_check_error();
47                 exit (1);
48         }
49         printf ("close successful\n");
50 
51 
52         printf ("reading back %s\n", argv[1]);
53         if ((fd = gfal_open (argv[1], O_RDONLY, 0)) < 0) {
54                 gfal_posix_check_error();
55                 exit (1);
56         }
57         printf ("open successful, fd = %d\n", fd);
58 
59         if ((rc = gfal_read (fd, ibuf, BLKLEN)) != BLKLEN) {
60                         gfal_posix_check_error();
61                         (void) gfal_close (fd);
62                         exit (1);
63            }
64            printf ("read successful\n");
65 
66            if ((rc = gfal_close (fd)) < 0) {
67                         gfal_posix_check_error();
68                         exit (1);
69            }
70            printf ("close successful\n");
71 
72            for (i = 0; i < BLKLEN; i++) {
73                    if (ibuf[i] != obuf[i]) {
74                                 fprintf (stderr, "compare failed at offset %d\n", i);
75                                 exit (1);
76                    }
77            }
78            printf ("compare successful\n");
79            exit (0);
80 }
\end{verbatim}
\end{DocInclude}
 