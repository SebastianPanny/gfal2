\section{gfal\_\-testrw.c}
This exemple show how to open, write a file and read it after ex : use case with SRM plugin : ./gfal\_\-testrw srm://grid05.lal.in2p3.fr:8446/dpm/lal.in2p3.fr/home/dteam/test\_\-yoda



\begin{DocInclude}\begin{verbatim}1 
7 #include <fcntl.h>
8 #include <stdio.h>
9 #include "gfal_api.h"
10 #include <stdlib.h>
11 #define BLKLEN 65536
12 
13 main(int argc, char **argv)
14 {
15    int fd;
16    int i;
17    char ibuf[BLKLEN];
18    char obuf[BLKLEN];
19    int rc;
20 
21    // gfal_set_verbose(GFAL_VERBOSE_TRACE | GFAL_VERBOSE_VERBOSE);      // switch Gfal in verbose mode
22    if (argc != 2) {
23            fprintf (stderr, "usage: %s filename\n", argv[0]);
24            exit (1);
25    }
26 
27    for (i = 0; i < BLKLEN; i++)
28            obuf[i] = i;
29 
30    printf ("creating file %s\n", argv[1]);
31    if ((fd = gfal_open (argv[1], O_WRONLY|O_CREAT, 0644)) < 0) {
32                 gfal_posix_check_error();
33            exit (1);
34    }
35    
36         printf ("open successful, fd = %d\n", fd);
37 
38         if ((rc = gfal_write (fd, obuf, BLKLEN)) != BLKLEN) {
39            if (rc < 0)
40                    gfal_posix_check_error();
41            else
42                    fprintf (stderr, "gfal_write returns %d\n", rc);
43            (void) gfal_close (fd);
44            exit (1);
45         }
46         printf ("write successful\n");
47 
48         if ((rc = gfal_close (fd)) < 0) {
49            gfal_posix_check_error();
50            exit (1);
51         }
52         printf ("close successful\n");
53 
54 
55         printf ("reading back %s\n", argv[1]);
56         if ((fd = gfal_open (argv[1], O_RDONLY, 0)) < 0) {
57            gfal_posix_check_error();
58            exit (1);
59         }
60         printf ("open successful, fd = %d\n", fd);
61 
62         if ((rc = gfal_read (fd, ibuf, BLKLEN)) != BLKLEN) {
63                    if (rc < 0)
64                           gfal_posix_check_error();
65                    else
66                            fprintf (stderr, "gfal_read returns %d\n", rc);
67                    (void) gfal_close (fd);
68                    exit (1);
69            }
70            printf ("read successful\n");
71 
72            if ((rc = gfal_close (fd)) < 0) {
73                    gfal_posix_check_error();
74                    exit (1);
75            }
76            printf ("close successful\n");
77 
78            for (i = 0; i < BLKLEN; i++) {
79                    if (ibuf[i] != obuf[i]) {
80                            fprintf (stderr, "compare failed at offset %d\n", i);
81                            exit (1);
82                    }
83            }
84            printf ("compare successful\n");
85            exit (0);
86 }
\end{verbatim}
\end{DocInclude}
 